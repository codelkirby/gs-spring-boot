stages:
  - build
  - docker
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - complete/build
build:
  stage: build
  script:
    - export AWS_PROFILE=l2f
    - aws ec2 describe-subnets
    - whoami
    - ls -altr
    - cd complete
    - ./gradlew build
  artifacts:
    paths:
      - complete/build
docker build:
  stage: docker
  script:
    - aws ecr get-login-password --region us-west-2 | docker login --username AWS --password-stdin 698579318444.dkr.ecr.us-west-2.amazonaws.com
    - docker build -t gs-boot .
    - docker tag gs-boot:latest 698579318444.dkr.ecr.us-west-2.amazonaws.com/gs-boot:latest
    - docker push 698579318444.dkr.ecr.us-west-2.amazonaws.com/gs-boot:latest